var x=Object.defineProperty;var _=(n,e,t)=>e in n?x(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>_(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var h=(n=>(n.DRAW="draw",n.PLAY="play",n.SCORE="score",n.ROUND_END="round_end",n.CHECKPOINT="checkpoint",n.GAME_END="game_end",n))(h||{}),o=(n=>(n.HENCHMAN="henchman",n.LOCATION="location",n.CRIME="crime",n.GEAR="gear",n))(o||{}),c=(n=>(n.GOON="goon",n.THUG="thug",n.ASSASSIN="assassin",n.HACKER="hacker",n.COMPANION="companion",n.SCIENTIST="scientist",n.WAREHOUSE="warehouse",n.LAB="lab",n.HIDEOUT="hideout",n.BASE="base",n.HEIST="heist",n.SABOTAGE="sabotage",n.INFILTRATION="infiltration",n.TERROR="terror",n.WEAPON="weapon",n.TOOL="tool",n.VEHICLE="vehicle",n.TECH="tech",n))(c||{});const k={id:"armed_goons",description:"Gives +3 to all Goons",type:"aura",targets:{subtype:c.GOON},effect:{add:3}},O={id:"cyber_enhanced",description:"Gives +5 to all Hackers",type:"aura",targets:{subtype:c.HACKER},effect:{add:5}},w={id:"quick_getaway",description:"Gives +2 to all Crimes",type:"aura",targets:{type:o.CRIME},effect:{add:2}},y={id:"henchman_network",description:"+2 for each other Henchman",type:"conditional",targets:{self:!0},condition:{requires:{type:o.HENCHMAN,count:1}},effect:{add:2,perCard:!0}},N={id:"perfect_target",description:"+5 if Location is present",type:"conditional",targets:{self:!0},condition:{requires:{type:o.LOCATION}},effect:{add:5}},D={id:"equipped_saboteur",description:"+3 for each Gear card",type:"conditional",targets:{self:!0},condition:{requires:{type:o.GEAR,count:1}},effect:{add:3,perCard:!0}},G={id:"weapon_researcher",description:"+5 for each Gear card",type:"conditional",targets:{self:!0},condition:{requires:{type:o.GEAR,count:1}},effect:{add:5,perCard:!0}},$={id:"pack_mentality",description:"+2 for each other Companion",type:"conditional",targets:{self:!0},condition:{requires:{subtype:c.COMPANION,count:1}},effect:{add:2,perCard:!0}},q={id:"lazy_goon_persist",description:"Stays for 2 turns",type:"aura",targets:{self:!0},effect:{persistTurns:2}},V={id:"sustainable_researcher",description:"All Gear returns to hand",type:"aura",targets:{type:o.GEAR},effect:{returnToHand:!0}},z={id:"stray_cat_draw",description:"Draw 2 cards if no other Companions",type:"conditional",targets:{self:!0},condition:{requires:{subtype:c.COMPANION,count:0}},effect:{drawCards:2}},F={id:"good_boy_pack",description:"Next pack +1 card",type:"conditional",targets:{self:!0},effect:{modifyPacks:1}},W={id:"gear_amplifier",description:"Doubles all Gear effects",type:"multiplier",targets:{type:o.GEAR},effect:{multiply:2}},C={id:"strategic_location",description:"Doubles all Henchman scores",type:"multiplier",targets:{type:o.HENCHMAN},effect:{multiply:2}},L={id:"high_tech_lab",description:"Triples score of Tech gear",type:"multiplier",targets:{subtype:c.TECH},effect:{multiply:3}},U={id:"strategic_planning",description:"+5 if played first",type:"conditional",targets:{self:!0},condition:{position:0},effect:{add:5}},M={id:"finishing_move",description:"+3 if played last",type:"conditional",targets:{self:!0},condition:{position:2},effect:{add:3}},R=[{id:"goon_1",name:"Street Goon",type:o.HENCHMAN,subtype:c.GOON,baseScore:2,description:"A basic thug for your schemes",rules:[y],rarity:"common",cost:1},{id:"goon_2",name:"Professional Goon",type:o.HENCHMAN,subtype:c.GOON,baseScore:3,description:"A more experienced street thug",rules:[y],rarity:"uncommon",cost:2},{id:"goon_3",name:"Elite Goon",type:o.HENCHMAN,subtype:c.GOON,baseScore:4,description:"The best muscle money can buy",rules:[y],rarity:"rare",cost:3},{id:"thug_1",name:"Heavy Thug",type:o.HENCHMAN,subtype:c.THUG,baseScore:3,description:"A strong enforcer for your operations",rules:[y],rarity:"common",cost:2},{id:"thug_2",name:"Brutal Thug",type:o.HENCHMAN,subtype:c.THUG,baseScore:4,description:"Intimidation specialist",rules:[y],rarity:"uncommon",cost:2},{id:"thug_3",name:"Demolition Thug",type:o.HENCHMAN,subtype:c.THUG,baseScore:4,description:"Specializes in making things go boom",rules:[y],rarity:"rare",cost:3},{id:"assassin_1",name:"Silent Assassin",type:o.HENCHMAN,subtype:c.ASSASSIN,baseScore:4,description:"A deadly operative for precision work",rules:[y],rarity:"uncommon",cost:3},{id:"assassin_2",name:"Master Assassin",type:o.HENCHMAN,subtype:c.ASSASSIN,baseScore:5,description:"Elite killer with no conscience",rules:[y],rarity:"rare",cost:4},{id:"hacker_1",name:"Cyber Hacker",type:o.HENCHMAN,subtype:c.HACKER,baseScore:3,description:"A tech-savvy operative for digital crimes",rules:[y],rarity:"uncommon",cost:2},{id:"hacker_2",name:"Elite Hacker",type:o.HENCHMAN,subtype:c.HACKER,baseScore:4,description:"Can break any system",rules:[y],rarity:"rare",cost:3},{id:"mastermind_1",name:"The Mastermind",type:o.HENCHMAN,subtype:c.THUG,baseScore:3,description:"Best when leading the operation",rules:[y,U],rarity:"rare",cost:3},{id:"wolf_1",name:"Wolf",type:o.HENCHMAN,subtype:c.COMPANION,baseScore:3,description:"Doubles score for each other Companion",rules:[$],rarity:"common",cost:2},{id:"mad_scientist_1",name:"Mad Scientist",type:o.HENCHMAN,subtype:c.SCIENTIST,baseScore:2,description:"Doubles the effect of all Gear on the board",rules:[W],rarity:"common",cost:2},{id:"weapon_researcher_1",name:"Weapon Researcher",type:o.HENCHMAN,subtype:c.SCIENTIST,baseScore:2,description:"Gets +5 for every Gear on the board",rules:[G],rarity:"common",cost:2},{id:"lazy_goon_1",name:"Lazy Goon",type:o.HENCHMAN,subtype:c.GOON,baseScore:4,description:"Stays on the board for 2 turns",rules:[q],rarity:"common",cost:2},{id:"sustainable_researcher_1",name:"Sustainable Researcher",type:o.HENCHMAN,subtype:c.SCIENTIST,baseScore:3,description:"All Gear returns to your hand",rules:[V],rarity:"uncommon",cost:3},{id:"stray_cat_1",name:"Stray Cat",type:o.HENCHMAN,subtype:c.COMPANION,baseScore:6,description:"Draw 2 cards if no other Companions",rules:[z],rarity:"uncommon",cost:3},{id:"good_boy_1",name:"Good Boy",type:o.HENCHMAN,subtype:c.COMPANION,baseScore:5,description:"Next booster pack has +1 card",rules:[F],rarity:"uncommon",cost:3},{id:"warehouse_1",name:"Abandoned Warehouse",type:o.LOCATION,subtype:c.WAREHOUSE,baseScore:1,description:"Perfect hideout - doubles henchman effectiveness",rules:[C],rarity:"common",cost:1},{id:"warehouse_2",name:"Secure Warehouse",type:o.LOCATION,subtype:c.WAREHOUSE,baseScore:2,description:"Well-protected storage - doubles henchman effectiveness",rules:[C],rarity:"uncommon",cost:2},{id:"warehouse_3",name:"Port Warehouse",type:o.LOCATION,subtype:c.WAREHOUSE,baseScore:2,description:"Strategic docks location - doubles henchman effectiveness",rules:[C],rarity:"uncommon",cost:2},{id:"lab_1",name:"Secret Lab",type:o.LOCATION,subtype:c.LAB,baseScore:2,description:"High-tech facility - triples tech gear power",rules:[L],rarity:"uncommon",cost:2},{id:"lab_2",name:"Advanced Research Lab",type:o.LOCATION,subtype:c.LAB,baseScore:3,description:"Cutting-edge technology - triples tech gear power",rules:[L],rarity:"rare",cost:3},{id:"hideout_1",name:"Safe House",type:o.LOCATION,subtype:c.HIDEOUT,baseScore:1,description:"A secure place to plan operations",rules:[C],rarity:"common",cost:1},{id:"hideout_2",name:"Fortified Hideout",type:o.LOCATION,subtype:c.HIDEOUT,baseScore:2,description:"Nearly impregnable stronghold",rules:[C],rarity:"uncommon",cost:2},{id:"hideout_3",name:"Penthouse Hideout",type:o.LOCATION,subtype:c.HIDEOUT,baseScore:3,description:"Luxury base with great city views",rules:[C],rarity:"rare",cost:3},{id:"base_1",name:"Underground Base",type:o.LOCATION,subtype:c.BASE,baseScore:3,description:"Secure headquarters - doubles henchman effectiveness",rules:[C],rarity:"rare",cost:4},{id:"base_2",name:"Command Center",type:o.LOCATION,subtype:c.BASE,baseScore:4,description:"Central hub - doubles henchman effectiveness",rules:[C],rarity:"legendary",cost:5},{id:"heist_1",name:"Bank Heist",type:o.CRIME,subtype:c.HEIST,baseScore:8,description:"Classic money-grabbing operation",rules:[N],rarity:"common",cost:2},{id:"heist_2",name:"Casino Heist",type:o.CRIME,subtype:c.HEIST,baseScore:10,description:"Hit the jackpot, literally",rules:[N],rarity:"uncommon",cost:3},{id:"heist_3",name:"Museum Heist",type:o.CRIME,subtype:c.HEIST,baseScore:12,description:"Steal priceless artifacts",rules:[N],rarity:"rare",cost:4},{id:"heist_4",name:"Armored Car Heist",type:o.CRIME,subtype:c.HEIST,baseScore:9,description:"Rob money in transit",rules:[N],rarity:"common",cost:2},{id:"sabotage_1",name:"Industrial Sabotage",type:o.CRIME,subtype:c.SABOTAGE,baseScore:9,description:"Disrupt enemy operations",rules:[D],rarity:"common",cost:2},{id:"sabotage_2",name:"Data Center Sabotage",type:o.CRIME,subtype:c.SABOTAGE,baseScore:11,description:"Bring down their digital infrastructure",rules:[D],rarity:"uncommon",cost:3},{id:"infiltration_1",name:"Corporate Infiltration",type:o.CRIME,subtype:c.INFILTRATION,baseScore:10,description:"Infiltrate and gather intelligence",rules:[],rarity:"uncommon",cost:3},{id:"infiltration_2",name:"Government Infiltration",type:o.CRIME,subtype:c.INFILTRATION,baseScore:12,description:"Access classified information",rules:[],rarity:"rare",cost:4},{id:"terror_1",name:"Intimidation Campaign",type:o.CRIME,subtype:c.TERROR,baseScore:8,description:"Spread fear through the city",rules:[M],rarity:"common",cost:2},{id:"terror_2",name:"Citywide Terror",type:o.CRIME,subtype:c.TERROR,baseScore:11,description:"Paralyze the entire city with fear",rules:[M],rarity:"rare",cost:4},{id:"baseball_bat",name:"Baseball Bat",type:o.GEAR,subtype:c.WEAPON,baseScore:1,description:"Simple but effective - arms your goons",rules:[k],rarity:"common",cost:1},{id:"knife",name:"Combat Knife",type:o.GEAR,subtype:c.WEAPON,baseScore:2,description:"Silent and deadly - arms your goons",rules:[k],rarity:"common",cost:1},{id:"pistol",name:"Pistol",type:o.GEAR,subtype:c.WEAPON,baseScore:3,description:"Standard criminal firearm - arms your goons",rules:[k],rarity:"uncommon",cost:2},{id:"rifle",name:"Assault Rifle",type:o.GEAR,subtype:c.WEAPON,baseScore:5,description:"Military-grade weaponry - arms your goons",rules:[k],rarity:"rare",cost:3},{id:"crowbar",name:"Crowbar",type:o.GEAR,subtype:c.TOOL,baseScore:2,description:"Perfect for breaking and entering",rules:[],rarity:"common",cost:1},{id:"lockpicks",name:"Lockpick Set",type:o.GEAR,subtype:c.TOOL,baseScore:3,description:"Silent entry specialist tools",rules:[],rarity:"uncommon",cost:2},{id:"explosives",name:"Explosives",type:o.GEAR,subtype:c.TOOL,baseScore:4,description:"When subtlety fails",rules:[],rarity:"rare",cost:3},{id:"getaway_car",name:"Getaway Car",type:o.GEAR,subtype:c.VEHICLE,baseScore:3,description:"Fast escape - boosts crime scores",rules:[w],rarity:"uncommon",cost:2},{id:"motorcycle",name:"Sport Motorcycle",type:o.GEAR,subtype:c.VEHICLE,baseScore:2,description:"Quick and agile - boosts crime scores",rules:[w],rarity:"common",cost:1},{id:"helicopter",name:"Helicopter",type:o.GEAR,subtype:c.VEHICLE,baseScore:5,description:"Ultimate escape - boosts crime scores",rules:[w],rarity:"legendary",cost:4},{id:"hacking_rig",name:"Hacking Rig",type:o.GEAR,subtype:c.TECH,baseScore:4,description:"Advanced computer setup - empowers hackers",rules:[O],rarity:"uncommon",cost:3},{id:"surveillance_kit",name:"Surveillance Kit",type:o.GEAR,subtype:c.TECH,baseScore:3,description:"Keep tabs on your targets - empowers hackers",rules:[O],rarity:"uncommon",cost:2}];class K{constructor(e){l(this,"state");l(this,"eventListeners",[]);this.state=this.initializeGame(e)}on(e){this.eventListeners.push(e)}off(e){const t=this.eventListeners.indexOf(e);t>-1&&this.eventListeners.splice(t,1)}emit(e){for(const t of this.eventListeners)t(e)}initializeGame(e){const t=e?[...e]:[...R];return this.shuffleDeck(t),{round:1,targetScore:75,hand:t.splice(0,6),playedCards:[],score:0,cumulativeScore:0,checkpoint:5,currency:0,playerDeck:[],deck:t,discardPile:[],playerStats:{totalScore:0,roundsWon:0,roundsLost:0,cardsPlayed:0,synergiesActivated:0},gamePhase:h.PLAY,cardPlayCounts:new Map,packBonusCards:0,permanentPackBonus:0}}shuffleDeck(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}}getState(){return{...this.state}}playCard(e,t){if(this.state.gamePhase!==h.PLAY||this.state.playedCards.length>=3)return!1;const a=this.state.hand.findIndex(d=>d.id===e);if(a===-1)return!1;const s=this.state.hand[a],i={card:s,position:t};this.state.hand.splice(a,1),this.state.playedCards.push(i),this.state.playerStats.cardsPlayed++;const r=this.state.cardPlayCounts.get(s.name)||0;return this.state.cardPlayCounts.set(s.name,r+1),this.emit({type:"card_played",card:s,position:t}),this.executeOnPlayEffects(i),!0}unplayCard(e){if(this.state.gamePhase!==h.PLAY)return!1;const t=this.state.playedCards.findIndex(s=>s.card.id===e);if(t===-1)return!1;const a=this.state.playedCards.splice(t,1)[0];return this.state.hand.push(a.card),this.emit({type:"card_unplayed",card:a.card}),!0}endTurn(){if(this.state.gamePhase!==h.PLAY)throw new Error("Cannot end turn in current phase");const e=this.calculateScore();return this.state.score=e.score,this.state.cumulativeScore+=e.score,this.state.gamePhase=h.SCORE,this.state.playerStats.totalScore=this.state.cumulativeScore,this.state.playerStats.synergiesActivated+=e.synergiesActivated.length,this.awardCurrency(e),this.state.round>=this.state.checkpoint&&(e.success=this.state.cumulativeScore>=this.state.targetScore,e.success?(this.state.playerStats.roundsWon++,this.state.currency+=50,this.state.gamePhase=h.CHECKPOINT):(this.state.playerStats.roundsLost++,this.state.gamePhase=h.GAME_END)),e}calculateScore(){const e=this.evaluateAllRules(),t=[];for(const s of this.state.playedCards)s.scoring={baseScore:s.card.baseScore,buffsReceived:[],buffsGiven:[],finalScore:s.card.baseScore};for(const s of e){const i=this.state.playedCards.find(d=>d.card.id===s.sourceCardId),r=this.state.playedCards.find(d=>d.card.id===s.targetCardId);i!=null&&i.scoring&&(r!=null&&r.scoring)&&(i.scoring.buffsGiven.push(s),r.scoring.buffsReceived.push(s),t.includes(s.description)||t.push(s.description))}for(const s of this.state.playedCards){if(!s.scoring)continue;let i=s.scoring.baseScore;for(const r of s.scoring.buffsReceived)r.isMultiplier||(i+=r.value);s.scoring.finalScore=i}for(const s of this.state.playedCards){if(!s.scoring)continue;let i=s.scoring.finalScore;for(const r of s.scoring.buffsReceived)r.isMultiplier&&(i=Math.floor(i*r.value));s.scoring.finalScore=i}const a=this.state.playedCards.reduce((s,i)=>{var r;return s+(((r=i.scoring)==null?void 0:r.finalScore)||i.card.baseScore)},0);return{score:a,targetScore:this.state.targetScore,success:!1,synergiesActivated:t,bonusScore:a-this.state.playedCards.reduce((s,i)=>s+i.card.baseScore,0)}}evaluateAllRules(){const e=[];let t=0;for(const a of this.state.playedCards)for(const s of a.card.rules){if(!this.checkRuleCondition(s,a))continue;const i=this.findRuleTargets(s,a);for(const r of i){const d=this.calculateRuleValue(s,a);e.push({id:`buff_${t++}`,ruleId:s.id,sourceCardId:a.card.id,targetCardId:r.card.id,description:s.description,value:d,isMultiplier:s.effect.multiply!==void 0,applied:!1})}}return e}checkRuleCondition(e,t){if(!e.condition)return!0;if(e.condition.position!==void 0&&t.position!==e.condition.position)return!1;if(e.condition.requires){const a=e.condition.requires,s=this.state.playedCards.filter(r=>!(r.card.id===t.card.id||a.type&&r.card.type!==a.type||a.subtype&&r.card.subtype!==a.subtype)),i=a.count||1;if(s.length<i)return!1}return!0}findRuleTargets(e,t){const a=[];if(e.targets.self)return[t];for(const s of this.state.playedCards)s.card.id!==t.card.id&&(e.targets.type&&s.card.type!==e.targets.type||e.targets.subtype&&s.card.subtype!==e.targets.subtype||e.targets.position!==void 0&&s.position!==e.targets.position||a.push(s));return a}calculateRuleValue(e,t){var s;let a=0;if(e.effect.add!==void 0?a=e.effect.add:e.effect.multiply!==void 0&&(a=e.effect.multiply),e.effect.perCard&&((s=e.condition)!=null&&s.requires)){const i=e.condition.requires,r=this.state.playedCards.filter(d=>!(d.card.id===t.card.id||i.type&&d.card.type!==i.type||i.subtype&&d.card.subtype!==i.subtype));a*=r.length}return a}startNextRound(){if(this.state.gamePhase!==h.SCORE)throw new Error("Cannot start next round in current phase");const e=[],t=[],a=[];for(const r of this.state.playedCards)r.persistsForTurns!==void 0?(r.turnsInPlay=(r.turnsInPlay||0)+1,r.turnsInPlay<r.persistsForTurns?(e.push(r),this.emit({type:"card_persists",card:r.card,turnsRemaining:r.persistsForTurns-r.turnsInPlay})):r.returnToHand?t.push(r.card):a.push(r.card)):r.returnToHand?t.push(r.card):a.push(r.card);this.state.playedCards=e,this.state.hand.push(...t),this.state.discardPile.push(...a),t.length>0&&this.emit({type:"cards_returned_to_hand",cards:t}),this.state.score=0;const s=6-this.state.hand.length,i=[];for(let r=0;r<s&&this.state.deck.length>0;r++){const d=this.state.deck.pop();this.state.hand.push(d),i.push(d)}i.length>0&&this.emit({type:"cards_drawn",cards:i}),this.state.round++,this.state.gamePhase=h.PLAY,this.emit({type:"round_start",round:this.state.round})}getHand(){return[...this.state.hand]}getPlayedCards(){return[...this.state.playedCards]}getCurrentScore(){return this.state.score}getTargetScore(){return this.state.targetScore}getRound(){return this.state.round}getCheckpoint(){return this.state.checkpoint}getCurrency(){return this.state.currency}getPlayerDeck(){return[...this.state.playerDeck]}getPlayerStats(){return{...this.state.playerStats}}awardCurrency(e){let t=0;t+=10,t+=e.synergiesActivated.length*5,this.state.currency+=t}enterCheckpoint(){if(this.state.gamePhase!==h.CHECKPOINT)throw new Error("Not at a checkpoint")}continueToNextCheckpoint(){if(this.state.gamePhase!==h.CHECKPOINT)throw new Error("Can only continue from checkpoint phase");this.state.checkpoint+=5,this.state.targetScore=Math.floor(this.state.targetScore*1.5),this.state.deck.length<10&&(this.state.deck.push(...this.state.discardPile),this.state.discardPile=[],this.shuffleDeck(this.state.deck)),this.state.gamePhase=h.SCORE}restartGame(){this.state=this.initializeGame()}buyBoosterPack(){if(this.state.currency<30)return null;this.state.currency-=30;const t=3+this.state.packBonusCards+this.state.permanentPackBonus,a=[...R],s=[];for(let i=0;i<t;i++){const r=Math.floor(Math.random()*a.length);s.push(a[r])}return this.state.packBonusCards=0,s}addCardToPlayerDeck(e){this.state.playerDeck.push({...e})}mergePlayerDeckIntoGame(){const e=[...R,...this.state.playerDeck];this.shuffleDeck(e),this.state.deck=e,this.state.discardPile=[]}getActiveBuffs(){return this.state.playedCards.length===0?[]:this.evaluateAllRules()}executeOnPlayEffects(e){for(const t of e.card.rules){const a=t.effect;a.persistTurns!==void 0&&(e.persistsForTurns=a.persistTurns,e.turnsInPlay=0,this.emit({type:"card_persists",card:e.card,turnsRemaining:a.persistTurns})),a.returnToHand&&(e.returnToHand=!0);const s=this.checkRuleCondition(t,e);if(a.drawCards&&s){const i=this.drawCards(a.drawCards);i.length>0&&(this.emit({type:"cards_drawn",cards:i,triggeredBy:e.card}),this.emit({type:"effect_triggered",card:e.card,effectDescription:`Draw ${i.length} card${i.length>1?"s":""}`,value:i.length}))}if(a.modifyPacks&&s&&(a.modifyPacksPermanent?(this.state.permanentPackBonus+=a.modifyPacks,this.emit({type:"pack_bonus_added",bonus:a.modifyPacks,triggeredBy:e.card,permanent:!0})):(this.state.packBonusCards+=a.modifyPacks,this.emit({type:"pack_bonus_added",bonus:a.modifyPacks,triggeredBy:e.card,permanent:!1})),this.emit({type:"effect_triggered",card:e.card,effectDescription:`Next pack +${a.modifyPacks} card${a.modifyPacks>1?"s":""}`,value:a.modifyPacks})),a.removeCards&&s){const i=this.removeCardsFromGame(a.removeCards);i.length>0&&(this.emit({type:"cards_removed",cards:i,reason:`Removed by ${e.card.name}`,triggeredBy:e.card}),this.emit({type:"effect_triggered",card:e.card,effectDescription:`Removed ${i.length} card${i.length>1?"s":""} from game`,value:i.length}))}}}drawCards(e){const t=[];for(let a=0;a<e;a++)if(this.state.deck.length===0&&this.state.discardPile.length>0&&(this.state.deck=[...this.state.discardPile],this.state.discardPile=[],this.shuffleDeck(this.state.deck)),this.state.deck.length>0){const s=this.state.deck.pop();this.state.hand.push(s),t.push(s)}return t}removeCardsFromGame(e){const t=[],a=d=>!(e.rarity&&d.rarity!==e.rarity||e.type&&d.type!==e.type),s=this.state.deck.filter(d=>a(d)?(t.push(d),!1):!0);this.state.deck=s;const i=this.state.hand.filter(d=>a(d)?(t.push(d),!1):!0);this.state.hand=i;const r=this.state.discardPile.filter(d=>a(d)?(t.push(d),!1):!0);return this.state.discardPile=r,t}}class S{constructor(e="div",t=""){l(this,"element");l(this,"children",[]);this.element=document.createElement(e),t&&(this.element.className=t)}getElement(){return this.element}addChild(e){this.children.push(e),this.element.appendChild(e.getElement())}removeChild(e){const t=this.children.indexOf(e);t>-1&&(this.children.splice(t,1),this.element.removeChild(e.getElement()))}clearChildren(){this.children.forEach(e=>{this.element.removeChild(e.getElement())}),this.children=[]}setVisible(e){this.element.style.display=e?"":"none"}addClass(e){this.element.classList.add(e)}removeClass(e){this.element.classList.remove(e)}setAttribute(e,t){this.element.setAttribute(e,t)}getAttribute(e){return this.element.getAttribute(e)}}class Y extends S{constructor(){super("div","game-header");l(this,"roundValue",null);l(this,"checkpointValue",null);l(this,"roundScoreValue",null);l(this,"cumulativeScoreValue",null);l(this,"targetValue",null);l(this,"currencyValue",null);l(this,"scoreFill",null);this.initializeElements()}initializeElements(){this.element.innerHTML=`
      <div class="council-chamber">
        <div class="council-title-banner">
          <div class="title-starburst">
            <h1 class="header-title">THE COUNCIL DECIDES</h1>
          </div>
          <div class="council-subtitle">League of Ultimate Evil - Scheme Approval Board</div>
        </div>

        <div class="council-judgment-panel">
          <div class="judgment-metric">
            <span class="metric-label">Audience:</span>
            <span class="metric-value" id="round-value">1</span>
            <span class="metric-suffix">/ <span id="checkpoint-value">5</span></span>
          </div>

          <div class="judgment-metric">
            <span class="metric-label">Villain Bucks:</span>
            <span class="metric-value highlight" id="currency-value">0</span>
          </div>

          <div class="judgment-metric">
            <span class="metric-label">This Scheme:</span>
            <span class="metric-value highlight" id="round-score-value">0</span>
            <span class="metric-suffix">pts</span>
          </div>

          <div class="judgment-metric approval-meter">
            <span class="metric-label">Council Approval:</span>
            <div class="approval-bar-container">
              <div class="approval-bar-bg">
                <div class="approval-bar-fill" id="score-fill" style="width: 0%"></div>
              </div>
              <div class="approval-scores">
                <span class="current-approval" id="cumulative-score-value">0</span>
                <span class="approval-divider">/</span>
                <span class="target-approval" id="target-value">75</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    `,this.roundValue=this.element.querySelector("#round-value"),this.checkpointValue=this.element.querySelector("#checkpoint-value"),this.currencyValue=this.element.querySelector("#currency-value"),this.roundScoreValue=this.element.querySelector("#round-score-value"),this.cumulativeScoreValue=this.element.querySelector("#cumulative-score-value"),this.targetValue=this.element.querySelector("#target-value"),this.scoreFill=this.element.querySelector("#score-fill")}render(){}updateRound(t,a){this.roundValue&&(this.roundValue.textContent=t.toString()),this.checkpointValue&&(this.checkpointValue.textContent=a.toString())}updateScore(t,a,s){if(this.roundScoreValue&&(this.roundScoreValue.textContent=t.toString()),this.cumulativeScoreValue&&(this.cumulativeScoreValue.textContent=a.toString()),this.targetValue&&(this.targetValue.textContent=s.toString()),this.scoreFill){const i=Math.min(100,a/s*100);this.scoreFill.style.width=`${i}%`}}updateCurrency(t){this.currencyValue&&(this.currencyValue.textContent=t.toString())}}var p=(n=>(n.DEFAULT="default",n.HOVER="hover",n.SELECTED="selected",n.PLAYABLE="playable",n.DISABLED="disabled",n.BUFFED="buffed",n.PLAYING="playing",n))(p||{});function H(n,e={}){const t=n.baseScore,a=e.finalScore??t,s=a-t;return{card:n,baseScore:t,finalScore:a,scoreChange:s,hasScoreChange:s!==0,buffs:e.buffs??[],buffsReceived:e.buffsReceived??[],buffsGiven:e.buffsGiven??[],uiState:e.uiState??"default",isPlayable:e.isPlayable??!1,isSelected:e.isSelected??!1,onClick:e.onClick,onHover:e.onHover}}class B{constructor(e){l(this,"container");l(this,"displayData");l(this,"scoreElement",null);l(this,"badgeContainer",null);this.displayData=e,this.container=this.createCardElement()}createCardElement(){const e=this.displayData.card,t=this.getTypeColor(e.type),a=this.getRarityColor(e.rarity),s=document.createElement("div");s.className=this.getCardClasses(),s.setAttribute("data-card-id",e.id);const i=document.createElement("div");i.className="card-inner",i.style.borderColor=t;const r=this.createHeader(t);i.appendChild(r);const d=this.createBody();i.appendChild(d);const m=this.createFooter(a);if(i.appendChild(m),e.rules.length>0){const u=this.createRulesSection();i.appendChild(u)}if(s.appendChild(i),this.displayData.buffsReceived.length>0){const u=this.createBuffBadges();this.badgeContainer=u,s.appendChild(u)}const f=this.createTooltip();return s.appendChild(f),s}createHeader(e){const t=document.createElement("div");t.className="card-header";const a=document.createElement("h3");a.className="card-name",a.textContent=this.displayData.card.name;const s=document.createElement("div");return s.className="card-type",s.style.backgroundColor=e,s.textContent=this.displayData.card.type.toUpperCase(),t.appendChild(a),t.appendChild(s),t}createBody(){const e=document.createElement("div");e.className="card-body";const t=this.createScoreDisplay();this.scoreElement=t,e.appendChild(t);const a=document.createElement("p");return a.className="card-description",a.textContent=this.displayData.card.description,e.appendChild(a),e}createScoreDisplay(){const e=document.createElement("div");if(e.className="card-score-container",this.displayData.hasScoreChange){e.classList.add("card-score-buffed");const t=document.createElement("div");t.className="card-score-final",t.textContent=this.displayData.finalScore.toString(),e.appendChild(t);const a=document.createElement("div");a.className="card-score-change",a.textContent=`+${this.displayData.scoreChange}`,e.appendChild(a);const s=document.createElement("div");s.className="card-score-base",s.textContent=this.displayData.baseScore.toString(),e.appendChild(s)}else{const t=document.createElement("div");t.className="card-score",t.textContent=this.displayData.baseScore.toString(),e.appendChild(t)}return e}createFooter(e){const t=document.createElement("div");t.className="card-footer";const a=document.createElement("div");a.className="card-rarity",a.style.color=e,a.textContent=this.displayData.card.rarity.toUpperCase();const s=document.createElement("div");return s.className="card-cost",s.textContent=`Cost: ${this.displayData.card.cost}`,t.appendChild(a),t.appendChild(s),t}createRulesSection(){const e=document.createElement("div");e.className="card-synergies";const t=document.createElement("div");return t.className="synergy-title",t.textContent="Rules:",e.appendChild(t),this.displayData.card.rules.forEach(a=>{const s=document.createElement("div");s.className="synergy-item",s.textContent=a.description,e.appendChild(s)}),e}createTooltip(){const e=this.displayData.card,t=document.createElement("div");t.className="card-tooltip";const a=document.createElement("div");a.className="card-tooltip-title",a.textContent=e.name,t.appendChild(a);const s=document.createElement("div");s.className="card-tooltip-section";const i=document.createElement("div");i.className="card-tooltip-label",i.textContent="Type",s.appendChild(i);const r=document.createElement("div");r.className="card-tooltip-text",r.textContent=`${e.type.toUpperCase()}${e.subtype?` - ${e.subtype}`:""}`,s.appendChild(r),t.appendChild(s);const d=document.createElement("div");d.className="card-tooltip-section";const m=document.createElement("div");m.className="card-tooltip-label",m.textContent="Description",d.appendChild(m);const f=document.createElement("div");if(f.className="card-tooltip-text",f.textContent=e.description,d.appendChild(f),t.appendChild(d),e.rules.length>0){const g=document.createElement("div");g.className="card-tooltip-section";const v=document.createElement("div");v.className="card-tooltip-label",v.textContent="Rules",g.appendChild(v);const T=document.createElement("div");T.className="card-tooltip-rules",e.rules.forEach(I=>{const P=document.createElement("div");P.className="card-tooltip-rule",P.textContent=I.description,T.appendChild(P)}),g.appendChild(T),t.appendChild(g)}const u=document.createElement("div");u.className="card-tooltip-section";const b=document.createElement("div");b.className="card-tooltip-label",b.textContent="Stats",u.appendChild(b);const A=document.createElement("div");return A.className="card-tooltip-text",A.innerHTML=`<strong>Base Score:</strong> ${e.baseScore}<br><strong>Rarity:</strong> ${e.rarity}<br><strong>Cost:</strong> ${e.cost}`,u.appendChild(A),t.appendChild(u),t}createBuffBadges(){const e=document.createElement("div");return e.className="buff-badges",this.displayData.buffsReceived.forEach(t=>{const a=document.createElement("div");a.className=`buff-badge ${t.isMultiplier?"multiplier":"additive"}`,a.textContent=t.isMultiplier?`Ã—${t.value}`:`+${t.value}`,a.title=t.description,e.appendChild(a)}),e}getCardClasses(){const e=["card"],t=this.displayData.uiState;return t!==p.DEFAULT&&e.push(`card-${t}`),this.displayData.buffsReceived.length>0&&e.push("card-buffed"),this.displayData.buffsGiven.length>0&&e.push("card-source"),this.displayData.isPlayable&&e.push("card-playable"),this.displayData.isSelected&&e.push("card-selected"),e.join(" ")}update(e){const t=this.displayData;this.displayData=e,(t.uiState!==e.uiState||t.buffsReceived.length!==e.buffsReceived.length||t.buffsGiven.length!==e.buffsGiven.length)&&(this.container.className=this.getCardClasses()),(t.finalScore!==e.finalScore||t.hasScoreChange!==e.hasScoreChange)&&this.updateScore(),t.buffsReceived.length!==e.buffsReceived.length&&this.updateBadges()}updateScore(){if(!this.scoreElement)return;const e=this.scoreElement.parentElement;if(e){const t=this.createScoreDisplay();e.replaceChild(t,this.scoreElement),this.scoreElement=t}}updateBadges(){if(this.badgeContainer&&(this.badgeContainer.remove(),this.badgeContainer=null),this.displayData.buffsReceived.length>0){const e=this.createBuffBadges();this.badgeContainer=e,this.container.appendChild(e)}}getElement(){return this.container}getTypeColor(e){switch(e){case o.HENCHMAN:return"var(--comic-purple)";case o.LOCATION:return"var(--comic-blue)";case o.CRIME:return"var(--comic-red)";case o.GEAR:return"var(--comic-orange)";default:return"#666"}}getRarityColor(e){switch(e){case"common":return"rgba(255, 255, 255, 0.6)";case"uncommon":return"var(--comic-cyan)";case"rare":return"var(--comic-pink)";case"legendary":return"var(--comic-yellow)";default:return"#666"}}}class E{constructor(e){l(this,"view");l(this,"displayData");this.displayData=e,this.view=new B(e),this.attachEventListeners()}static fromCard(e,t){const a=H(e,{onClick:t});return new E(a)}attachEventListeners(){const e=this.view.getElement();this.displayData.onClick&&e.addEventListener("click",()=>{this.displayData.onClick(this.displayData.card)}),e.addEventListener("mouseenter",()=>{this.handleMouseEnter()}),e.addEventListener("mouseleave",()=>{this.handleMouseLeave()})}handleMouseEnter(){this.displayData.uiState!==p.DISABLED&&(this.updateState(p.HOVER),this.displayData.onHover&&this.displayData.onHover(this.displayData.card))}handleMouseLeave(){this.displayData.isSelected?this.updateState(p.SELECTED):this.displayData.buffsReceived.length>0||this.displayData.buffsGiven.length>0?this.updateState(p.BUFFED):this.displayData.isPlayable?this.updateState(p.PLAYABLE):this.updateState(p.DEFAULT)}updateState(e){this.displayData.uiState!==e&&(this.displayData.uiState=e,this.view.update(this.displayData))}updateDisplayData(e){this.displayData={...this.displayData,...e},e.finalScore!==void 0&&(this.displayData.scoreChange=this.displayData.finalScore-this.displayData.baseScore,this.displayData.hasScoreChange=this.displayData.scoreChange!==0),this.view.update(this.displayData)}setPlayable(e){this.updateDisplayData({isPlayable:e}),e&&this.displayData.uiState===p.DEFAULT&&this.updateState(p.PLAYABLE)}setSelected(e){this.updateDisplayData({isSelected:e}),this.updateState(e?p.SELECTED:p.DEFAULT)}setBuffs(e,t){this.updateDisplayData({buffsReceived:e,buffsGiven:t}),(e.length>0||t.length>0)&&this.updateState(p.BUFFED)}getCard(){return this.displayData.card}getElement(){return this.view.getElement()}getDisplayData(){return{...this.displayData}}updateCard(e){this.displayData.card=e,this.displayData.baseScore=e.baseScore,this.displayData.finalScore!==this.displayData.baseScore&&(this.displayData.scoreChange=this.displayData.finalScore-this.displayData.baseScore,this.displayData.hasScoreChange=this.displayData.scoreChange!==0);const t=this.view.getElement(),a=t.parentElement,s=new B(this.displayData);a&&a.replaceChild(s.getElement(),t),this.view=s,this.attachEventListeners()}}class j extends S{constructor(){super("div","play-area");l(this,"cardsContainer");l(this,"cardComponents",new Map);l(this,"onCardClick");this.initializeElements()}setOnCardClick(t){this.onCardClick=t}initializeElements(){this.element.innerHTML=`
      <div class="play-area-header">
        <h3 class="area-title">Presenting to Council</h3>
        <div class="card-counter">
          <span id="played-count">0</span>/3 Schemes
        </div>
      </div>
      <div class="play-area-cards" id="play-cards">
        <!-- Card slots will be rendered here -->
        <div class="card-slot">Slot 1</div>
        <div class="card-slot">Slot 2</div>
        <div class="card-slot">Slot 3</div>
      </div>
    `,this.cardsContainer=this.element.querySelector("#play-cards")}render(){}updatePlayedCards(t,a=[]){this.cardsContainer.innerHTML="",this.cardComponents.clear();const s=[];for(let r=0;r<3;r++){const d=document.createElement("div");d.className="card-slot",d.textContent=`Slot ${r+1}`,s.push(d)}t.forEach((r,d)=>{var m;if(d<3){s[d].innerHTML="",s[d].classList.add("active");const f=a.filter(v=>v.targetCardId===r.card.id),u=a.filter(v=>v.sourceCardId===r.card.id),b=((m=r.scoring)==null?void 0:m.finalScore)??r.card.baseScore,A=H(r.card,{finalScore:b,buffsReceived:f,buffsGiven:u,onClick:this.onCardClick}),g=new E(A);g.setPlayable(!0),this.cardComponents.set(r.card.id,g),s[d].appendChild(g.getElement())}}),s.forEach(r=>this.cardsContainer.appendChild(r));const i=this.element.querySelector("#played-count");i.textContent=t.length.toString()}addCard(t){const a=E.fromCard(t);this.cardComponents.set(t.id,a),this.cardsContainer.appendChild(a.getElement()),this.updateCount()}removeCard(t){const a=this.cardComponents.get(t);a&&(this.cardsContainer.removeChild(a.getElement()),this.cardComponents.delete(t),this.updateCount())}clearCards(){this.cardsContainer.innerHTML="",this.cardComponents.clear(),this.updateCount()}updateCount(){const t=this.element.querySelector("#played-count");t.textContent=this.cardComponents.size.toString()}getCardCount(){return this.cardComponents.size}}class X extends S{constructor(){super("div","hand-area");l(this,"cardsContainer");l(this,"cardComponents",new Map);l(this,"onCardClick");this.initializeElements()}initializeElements(){this.element.innerHTML=`
      <div class="hand-area-header">
        <h3 class="area-title">Your Scheme Portfolio</h3>
        <div class="card-counter">
          <span id="hand-count">0</span>/7 Schemes
        </div>
      </div>
      <div class="hand-cards" id="hand-cards"></div>
    `,this.cardsContainer=this.element.querySelector("#hand-cards")}render(){}setOnCardClick(t){this.onCardClick=t}updateHand(t){this.cardsContainer.innerHTML="",this.cardComponents.clear(),t.forEach(a=>{const s=E.fromCard(a,this.onCardClick);s.setPlayable(!0),this.cardComponents.set(a.id,s),this.cardsContainer.appendChild(s.getElement())}),this.updateCount()}addCard(t){const a=E.fromCard(t,this.onCardClick);a.setPlayable(!0),this.cardComponents.set(t.id,a),this.cardsContainer.appendChild(a.getElement()),this.updateCount()}removeCard(t){const a=this.cardComponents.get(t);a&&(this.cardsContainer.removeChild(a.getElement()),this.cardComponents.delete(t),this.updateCount())}setCardPlayable(t,a){const s=this.cardComponents.get(t);s&&s.setPlayable(a)}setAllCardsPlayable(t){this.cardComponents.forEach(a=>{a.setPlayable(t)})}updateCount(){const t=this.element.querySelector("#hand-count");t.textContent=this.cardComponents.size.toString()}getCardCount(){return this.cardComponents.size}}class Q extends S{constructor(){super("div","game-controls");l(this,"endTurnButton");l(this,"nextRoundButton");l(this,"messageElement");this.initializeElements(),this.setupEventListeners()}initializeElements(){this.element.innerHTML=`
      <div class="controls-left">
        <button id="end-turn-btn" class="btn btn-primary">PRESENT SCHEMES!</button>
        <button id="next-round-btn" class="btn btn-success" disabled>NEXT AUDIENCE</button>
      </div>
      <div class="controls-right">
        <div class="message-display" id="message-display"></div>
      </div>
    `,this.endTurnButton=this.element.querySelector("#end-turn-btn"),this.nextRoundButton=this.element.querySelector("#next-round-btn"),this.messageElement=this.element.querySelector("#message-display")}setupEventListeners(){}render(){}setOnEndTurn(t){this.endTurnButton.addEventListener("click",t)}setOnNextRound(t){this.nextRoundButton.addEventListener("click",t)}updateButtonStates(t,a){switch(t){case"play":this.endTurnButton.disabled=a===0,this.nextRoundButton.disabled=!0;break;case"score":case"checkpoint":case"game_end":this.endTurnButton.disabled=!0,this.nextRoundButton.disabled=!1;break;default:this.endTurnButton.disabled=!0,this.nextRoundButton.disabled=!0}}showMessage(t,a="info"){this.messageElement.textContent=t,this.messageElement.className=`message-display show message-${a}`,setTimeout(()=>{this.messageElement.className="message-display"},3e3)}setEndTurnButtonEnabled(t){this.endTurnButton.disabled=!t}setNextRoundButtonEnabled(t){this.nextRoundButton.disabled=!t}}class Z extends S{constructor(){super("div","game-layout");l(this,"header");l(this,"playArea");l(this,"handArea");l(this,"controls");this.header=new Y,this.playArea=new j,this.handArea=new X,this.controls=new Q,this.setupLayout()}setupLayout(){const t=document.createElement("div");t.className="layout-container",t.appendChild(this.header.getElement()),t.appendChild(this.playArea.getElement()),t.appendChild(this.handArea.getElement()),t.appendChild(this.controls.getElement()),this.element.appendChild(t)}render(){this.header.render(),this.playArea.render(),this.handArea.render(),this.controls.render()}getHeader(){return this.header}getPlayArea(){return this.playArea}getHandArea(){return this.handArea}getControls(){return this.controls}getGameArea(){return{getPlayArea:()=>this.playArea,getHandArea:()=>this.handArea}}getStats(){return this.controls}}class J extends S{constructor(){super("div","shop-modal");l(this,"currency",0);l(this,"onBuyBooster");l(this,"onSkip");l(this,"buyButton");l(this,"skipButton");l(this,"currencyDisplay");this.element.style.display="none",this.initializeElements()}initializeElements(){this.element.innerHTML=`
      <div class="shop-overlay"></div>
      <div class="shop-content">
        <div class="comic-shop-sign">
          <h2 class="shop-title">THE EVIL EMPORIUM</h2>
          <p class="shop-subtitle">Purveyor of Fine Villainy</p>
        </div>

        <div class="shop-keeper-bubble">
          <p class="shop-message">Fresh schemes just in! Build your evil empire, one card at a time!</p>
        </div>

        <div class="currency-display">
          <span class="currency-label">Villain Bucks:</span>
          <span class="currency-amount" id="shop-currency">0</span>
        </div>

        <div class="shop-items">
          <div class="shop-item">
            <div class="comic-pack-wrapper">
              <div class="pack-shine"></div>
              <div class="pack-icon">PACK</div>
            </div>
            <div class="item-header">
              <h3 class="item-name">Mystery Pack</h3>
              <span class="item-cost">30 Villain Bucks</span>
            </div>
            <p class="item-description">3 random schemes! Pick your favorite!</p>
            <button id="buy-booster-btn" class="btn btn-primary">BUY NOW!</button>
          </div>
        </div>

        <div class="shop-actions">
          <button id="skip-shop-btn" class="btn btn-success">No Thanks, I'm Good</button>
        </div>
      </div>
    `,this.buyButton=this.element.querySelector("#buy-booster-btn"),this.skipButton=this.element.querySelector("#skip-shop-btn"),this.currencyDisplay=this.element.querySelector("#shop-currency"),this.buyButton.addEventListener("click",()=>{this.onBuyBooster&&this.onBuyBooster()}),this.skipButton.addEventListener("click",()=>{this.onSkip&&this.onSkip()})}render(){}show(t){this.currency=t,this.updateCurrencyDisplay(),this.updateBuyButtonState(),this.element.style.display="flex"}hide(){this.element.style.display="none"}updateCurrency(t){this.currency=t,this.updateCurrencyDisplay(),this.updateBuyButtonState()}updateCurrencyDisplay(){this.currencyDisplay&&(this.currencyDisplay.textContent=this.currency.toString())}updateBuyButtonState(){this.buyButton&&(this.buyButton.disabled=this.currency<30)}setOnBuyBooster(t){this.onBuyBooster=t}setOnSkip(t){this.onSkip=t}}class ee extends S{constructor(){super("div","booster-modal");l(this,"cardComponents",[]);l(this,"onCardSelected");l(this,"cardsContainer");this.element.style.display="none",this.initializeElements()}initializeElements(){this.element.innerHTML=`
      <div class="booster-overlay"></div>
      <div class="booster-content">
        <h2 class="booster-title">Choose One Card</h2>
        <p class="booster-message">Select a card to add to your deck</p>
        <div class="booster-cards" id="booster-cards">
          <!-- Cards will be rendered here -->
        </div>
      </div>
    `,this.cardsContainer=this.element.querySelector("#booster-cards")}render(){}show(t){if(t.length!==3)throw new Error("Booster pack must have exactly 3 cards");this.cardsContainer.innerHTML="",this.cardComponents=[],t.forEach(a=>{const s=H(a,{onClick:()=>{this.onCardSelected&&this.onCardSelected(a)}}),i=new E(s);i.setPlayable(!0),this.cardComponents.push(i);const r=document.createElement("div");r.className="booster-card-wrapper",r.appendChild(i.getElement()),this.cardsContainer.appendChild(r)}),this.element.style.display="flex"}hide(){this.element.style.display="none",this.cardsContainer.innerHTML="",this.cardComponents=[]}setOnCardSelected(t){this.onCardSelected=t}}class te{constructor(){l(this,"container");this.container=document.createElement("div"),this.container.className="comic-effects-container",document.body.appendChild(this.container)}show(e,t,a){const s=document.createElement("div");s.className="comic-effect",s.textContent=e,s.style.left=`${t}px`,s.style.top=`${a}px`,this.container.appendChild(s),setTimeout(()=>{s.classList.add("active")},10),setTimeout(()=>{s.remove()},1e3)}showRandom(e,t){const a=["POW!","BAM!","WHAM!","ZAP!","BOOM!","KAPOW!","SMASH!"],s=a[Math.floor(Math.random()*a.length)];this.show(s,e,t)}showForCardType(e,t,a){const i={crime:["SCHEME!","PLOT!","HEIST!"],henchman:["HIRED!","RECRUITED!","GOON!"],location:["LAIR!","HIDEOUT!","BASE!"],gear:["GADGET!","WEAPON!","TECH!"]}[e.toLowerCase()]||["POW!"],r=i[Math.floor(Math.random()*i.length)];this.show(r,t,a)}}class se{constructor(){l(this,"container");l(this,"isPlaying",!1);this.container=document.createElement("div"),this.container.className="score-cutscene-container",this.container.style.display="none"}async play(e,t,a){if(this.isPlaying)return;this.isPlaying=!0;let s=!1;const i=()=>{s=!0,this.skip()},r=document.querySelector(".game-layout");if(!r){a();return}if(r.classList.add("cutscene-mode"),this.buildCutsceneOverlay(e,t),r.appendChild(this.container),this.container.style.display="flex",setTimeout(()=>{s||(document.addEventListener("click",i,{once:!0}),document.addEventListener("keydown",d=>{(d.key===" "||d.key==="Escape")&&i()},{once:!0}))},300),await this.wait(100),this.container.classList.add("active"),!s){for(let d=0;d<e.length&&!s;d++)await this.animateCard(d),await this.wait(600);s||(await this.animateTotal(),await this.wait(1200))}await this.cleanup(r),this.isPlaying=!1,a()}buildCutsceneOverlay(e,t){this.container.innerHTML=`
      <div class="cutscene-letterbox cutscene-letterbox-top"></div>

      <div class="cutscene-content">
        <div class="cutscene-cards">
          ${e.map((a,s)=>`
            <div class="cutscene-card" data-index="${s}">
              <div class="cutscene-card-name">${a.card.name}</div>
              <div class="cutscene-card-type">${a.card.type}</div>

              <div class="cutscene-scoring-area">
                <div class="base-score-display">
                  <div class="score-label-small">BASE</div>
                  <div class="score-base" data-base="${a.baseScore}">${a.baseScore}</div>
                </div>

                ${a.bonusScore>0||a.synergies.length>0?`
                  <div class="synergy-effects">
                    ${a.synergies.map(i=>`
                      <div class="synergy-shout">${this.getSynergyShout(i)}</div>
                    `).join("")}
                    ${a.bonusScore>0?`
                      <div class="bonus-score-anim">+${a.bonusScore}</div>
                    `:""}
                  </div>
                `:""}

                <div class="final-score-burst">
                  <div class="burst-inner">
                    <div class="score-final" data-final="${a.totalScore}">${a.totalScore}</div>
                    <div class="score-suffix">PTS!</div>
                  </div>
                </div>
              </div>
            </div>
          `).join("")}
        </div>

        <div class="cutscene-total">
          <div class="total-label">TOTAL SCORE</div>
          <div class="total-value">${t}</div>
          <div class="total-suffix">POINTS!</div>
        </div>
      </div>

      <div class="cutscene-letterbox cutscene-letterbox-bottom">
        <div class="skip-hint">Click or press SPACE to skip</div>
      </div>
    `}getSynergyShout(e){const t=["COMBO!","SYNERGY!","BOOM!","POW!","WHAM!","KAPOW!","NICE!","SWEET!"],a=e.length%t.length;return t[a]}async animateCard(e){const t=this.container.querySelector(`.cutscene-card[data-index="${e}"]`);if(!t)return;t.classList.add("active"),await this.wait(400);const a=t.querySelector(".base-score-display");a&&(a.classList.add("show"),await this.wait(300));const s=t.querySelectorAll(".synergy-shout");for(const d of Array.from(s))d.classList.add("show"),await this.wait(200);const i=t.querySelector(".bonus-score-anim");i&&(i.classList.add("show"),await this.wait(300));const r=t.querySelector(".final-score-burst");return r&&(r.classList.add("show"),await this.wait(400)),this.wait(100)}async animateTotal(){const e=this.container.querySelector(".cutscene-total");if(e)return e.classList.add("active"),this.wait(400)}skip(){this.container.querySelectorAll(".cutscene-card").forEach(a=>{a.classList.add("active"),a.querySelectorAll(".base-score-display, .synergy-shout, .bonus-score-anim, .final-score-burst").forEach(s=>s.classList.add("show"))});const t=this.container.querySelector(".cutscene-total");t&&t.classList.add("active")}async cleanup(e){this.container.classList.remove("active"),await this.wait(300),e.classList.remove("cutscene-mode"),this.container.style.display="none",this.container.remove()}wait(e){return new Promise(t=>setTimeout(t,e))}isActive(){return this.isPlaying}}class ae{constructor(){l(this,"gameEngine");l(this,"layout");l(this,"shop");l(this,"boosterPack");l(this,"comicEffect");l(this,"scoreCutscene");l(this,"isInitialized",!1);try{this.gameEngine=new K,this.layout=new Z,this.shop=new J,this.boosterPack=new ee,this.comicEffect=new te,this.scoreCutscene=new se,this.initializeApp(),this.setupEventListeners(),this.setupShopListeners(),this.updateDisplay(),this.showWelcomeMessage(),this.isInitialized=!0}catch(e){console.error("Failed to initialize app:",e),this.handleInitializationError()}}initializeApp(){document.body.appendChild(this.layout.getElement()),document.body.appendChild(this.shop.getElement()),document.body.appendChild(this.boosterPack.getElement()),this.loadStyles()}loadStyles(){}setupShopListeners(){this.shop.setOnBuyBooster(()=>{const e=this.gameEngine.buyBoosterPack();e?(this.shop.updateCurrency(this.gameEngine.getCurrency()),this.boosterPack.show(e)):this.layout.getControls().showMessage("Not enough currency!","error")}),this.shop.setOnSkip(()=>{this.exitShop()}),this.boosterPack.setOnCardSelected(e=>{this.gameEngine.addCardToPlayerDeck(e),this.boosterPack.hide(),this.layout.getControls().showMessage(`Added ${e.name} to your deck!`,"success")})}setupEventListeners(){this.layout.getGameArea().getHandArea().setOnCardClick(e=>{this.playCard(e)}),this.layout.getGameArea().getPlayArea().setOnCardClick(e=>{this.unplayCard(e)}),this.layout.getControls().setOnEndTurn(()=>{this.endTurn()}),this.layout.getControls().setOnNextRound(()=>{const e=this.gameEngine.getState();e.gamePhase==="checkpoint"?this.handleCheckpoint():e.gamePhase==="game_end"?this.handleGameOver():this.startNextRound()})}updateDisplay(){console.time("[Performance] getState");const e=this.gameEngine.getState();console.timeEnd("[Performance] getState"),this.layout.getHeader().updateRound(e.round,e.checkpoint),this.layout.getHeader().updateScore(e.score,e.cumulativeScore,e.targetScore),this.layout.getHeader().updateCurrency(e.currency),console.time("[Performance] getActiveBuffs");const t=this.gameEngine.getActiveBuffs();console.timeEnd("[Performance] getActiveBuffs"),console.time("[Performance] updateHand"),this.layout.getGameArea().getHandArea().updateHand(e.hand),console.timeEnd("[Performance] updateHand"),console.time("[Performance] updatePlayedCards"),this.layout.getGameArea().getPlayArea().updatePlayedCards(e.playedCards,t),console.timeEnd("[Performance] updatePlayedCards"),this.layout.getControls().updateButtonStates(e.gamePhase,e.playedCards.length)}playCard(e){const t=this.gameEngine.getPlayedCards();if(t.length>=3){this.layout.getControls().showMessage("You can only play 3 cards per turn!","error");return}if(this.gameEngine.playCard(e.id,t.length)){const s=window.innerWidth/2,i=window.innerHeight/2;this.comicEffect.showForCardType(e.type,s,i),this.updateDisplay();const r=3-this.gameEngine.getPlayedCards().length;r>0?this.layout.getControls().showMessage(`Played ${e.name}! ${r} cards remaining.`,"success"):this.layout.getControls().showMessage(`Played ${e.name}! Ready to end turn.`,"success")}else this.layout.getControls().showMessage("Cannot play that card!","error")}unplayCard(e){this.gameEngine.unplayCard(e.id)?(this.updateDisplay(),this.layout.getControls().showMessage(`Returned ${e.name} to hand.`,"info")):this.layout.getControls().showMessage("Cannot return that card!","error")}endTurn(){try{console.time("[Performance] endTurn"),console.time("[Performance] gameEngine.endTurn");const e=this.gameEngine.endTurn();console.timeEnd("[Performance] gameEngine.endTurn");const a=this.gameEngine.getPlayedCards().map(s=>{var i,r,d,m,f,u;return{card:s.card,baseScore:((i=s.scoring)==null?void 0:i.baseScore)||s.card.baseScore,bonusScore:(((r=s.scoring)==null?void 0:r.finalScore)||0)-(((d=s.scoring)==null?void 0:d.baseScore)||s.card.baseScore),totalScore:((m=s.scoring)==null?void 0:m.finalScore)||s.card.baseScore,synergies:((u=(f=s.scoring)==null?void 0:f.buffsReceived)==null?void 0:u.map(b=>b.description))||[]}});this.scoreCutscene.play(a,e.score,()=>{console.time("[Performance] updateDisplay"),this.updateDisplay(),console.timeEnd("[Performance] updateDisplay"),console.timeEnd("[Performance] endTurn");const s=this.gameEngine.getState();if(s.gamePhase==="checkpoint")this.layout.getControls().showMessage(`Checkpoint ${s.checkpoint} reached! Score: ${s.cumulativeScore}/${s.targetScore}. Welcome to the shop!`,"success");else if(s.gamePhase==="game_end")this.layout.getControls().showMessage(`Game Over! Failed to reach ${s.targetScore} by round ${s.checkpoint}. Score: ${s.cumulativeScore}. Starting over...`,"error");else{const i=e.synergiesActivated.length>0?` Synergies: ${e.synergiesActivated.join(", ")}`:"";this.layout.getControls().showMessage(`Round ${s.round} complete! Scored ${e.score} points.${i} Total: ${s.cumulativeScore}/${s.targetScore}`,"info")}})}catch{this.layout.getControls().showMessage("Cannot end turn right now!","error")}}startNextRound(){this.gameEngine.startNextRound(),this.updateDisplay();const e=this.gameEngine.getState();this.layout.getControls().showMessage(`Round ${e.round} started! Checkpoint at round ${e.checkpoint}. Total: ${e.cumulativeScore}/${e.targetScore}`,"info")}handleCheckpoint(){const e=this.gameEngine.getCurrency();this.shop.show(e)}exitShop(){this.shop.hide(),this.gameEngine.mergePlayerDeckIntoGame(),this.gameEngine.continueToNextCheckpoint(),this.startNextRound();const e=this.gameEngine.getPlayerDeck().length;this.layout.getControls().showMessage(`Continuing to next checkpoint! New target: ${this.gameEngine.getTargetScore()}. Deck size: ${e} bonus cards`,"success")}handleGameOver(){this.gameEngine.restartGame(),this.updateDisplay(),this.showWelcomeMessage()}showWelcomeMessage(){const e=this.gameEngine.getTargetScore(),t=this.gameEngine.getCheckpoint();this.layout.getControls().showMessage(`Welcome! Reach ${e} points by round ${t}. Play up to 3 cards per round from your hand of 6!`,"info")}getGameEngine(){return this.gameEngine}getLayout(){return this.layout}isReady(){return this.isInitialized}destroy(){try{this.layout&&this.layout.getElement().remove(),this.isInitialized=!1}catch(e){console.error("Error during app cleanup:",e)}}handleInitializationError(){const e=document.createElement("div");e.className="error-container",e.innerHTML=`
      <div class="error-content">
        <h2>Failed to Load Game</h2>
        <p>There was an error initializing the game. Please refresh the page to try again.</p>
        <button onclick="location.reload()" class="btn btn-primary">Reload Page</button>
      </div>
    `,document.body.appendChild(e)}}document.addEventListener("DOMContentLoaded",()=>{const n=new ae;typeof window<"u"&&(window.gameApp=n)});
