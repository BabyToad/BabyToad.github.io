---
layout: base
---
<div class="post-container">
    {% if page.toc != false %}
    <nav class="toc" id="toc">
        <div class="toc-header">
            <h3>Contents</h3>
            <div class="progress-bar"><div class="progress" id="total-progress"></div></div>
        </div>
        <ul>
            <!-- TOC items will be generated by JavaScript -->
        </ul>
    </nav>
    {% endif %}

    <article class="post-content">
        <header class="post-header">
            <h1>{{ page.title }}</h1>
            <div class="post-metadata">
                <time datetime="{{ page.date | date_to_xmlschema }}" class="post-date">
                    {{ page.date | date: "%B %d, %Y" }}
                </time>
                {% if page.tags %}
                <div class="post-tags">
                    {% for tag in page.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% if page.description %}
            <div class="post-description">
                {{ page.description }}
            </div>
            {% endif %}
        </header>

        <div class="post-body">
            {{ content | replace: '[[', '<span class="sidenote-anchor">' | replace: ']]', '</span>' }}
        </div>

        <footer class="post-footer">
            <div class="post-navigation">
                {% if page.previous.url %}
                <a class="prev" href="{{page.previous.url}}">&larr; {{page.previous.title}}</a>
                {% endif %}
                {% if page.next.url %}
                <a class="next" href="{{page.next.url}}">{{page.next.title}} &rarr;</a>
                {% endif %}
            </div>
        </footer>
    </article>

    <div class="sidenotes">
        <!-- Sidenotes will be populated by JavaScript -->
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Generate Table of Contents
    const toc = document.getElementById('toc');
    if (toc) {
        const headings = document.querySelectorAll('.post-body h2');
        const tocList = toc.querySelector('ul');
        
        headings.forEach(heading => {
            const id = heading.textContent.toLowerCase().replace(/[^a-z0-9]+/g, '-');
            heading.id = id;
            
            const li = document.createElement('li');
            li.className = 'toc-item';
            li.innerHTML = `<a href="#${id}">${heading.textContent}</a>
                          <div class="progress-bar"><div class="progress"></div></div>`;
            tocList.appendChild(li);
        });
    }

    // Process Sidenotes
    const sidenotes = document.querySelector('.sidenotes');
    const anchors = document.querySelectorAll('.sidenote-anchor');
    
    anchors.forEach((anchor, index) => {
        const noteNumber = index + 1;
        
        // Get original text
        let originalText = anchor.getAttribute('data-original-text');
        if (!originalText) {
            originalText = anchor.textContent;
            anchor.setAttribute('data-original-text', originalText);
        }
        
        // Create and position the sidenote
        const sidenote = document.createElement('div');
        sidenote.className = 'sidenote';
        sidenote.innerHTML = `<sup>${noteNumber}</sup> ${originalText}`;
        
        // Position the sidenote at the same height as the anchor
        const anchorPosition = anchor.getBoundingClientRect();
        const containerPosition = sidenotes.getBoundingClientRect();
        const topPosition = anchorPosition.top - containerPosition.top;
        sidenote.style.top = `${topPosition}px`;
        
        sidenotes.appendChild(sidenote);
        
        // Update the anchor with the number
        anchor.innerHTML = `<sup>${noteNumber}</sup>`;
    });
});

// Update progress bars on scroll
window.addEventListener('scroll', () => {
    const headings = document.querySelectorAll('.post-body h2');
    const tocItems = document.querySelectorAll('.toc-item');
    const totalProgress = document.getElementById('total-progress');
    
    // Calculate total scroll progress
    const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
    totalProgress.style.width = `${scrollPercent}%`;
    
    // Update individual section progress
    headings.forEach((heading, index) => {
        if (index < headings.length - 1) {
            const nextHeading = headings[index + 1];
            const progress = Math.max(0, Math.min(1, 
                (window.scrollY - heading.offsetTop) / 
                (nextHeading.offsetTop - heading.offsetTop)
            )) * 100;
            
            tocItems[index].querySelector('.progress').style.width = `${progress}%`;
        }
    });
});
</script> 